<!DOCTYPE html>
<html>
<head>
  <title>Attendance System</title>
</head>
<body>
  <h2>Attendance Check</h2>
  <input type="text" id="phone" placeholder="Enter phone number">
  <button onclick="submitAttendance()">Submit</button>

  <p id="message"></p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabaseUrl = "https://kftyyyacxlxaghxwftxd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmdHl5eWFjeGx4YWdoeHdmdHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMTk5MDksImV4cCI6MjA4NzU5NTkwOX0._kaIiALNA2-K0lFf1AJcX-0X2lmxF1c15sUDJAKes3I";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

async function submitAttendance() {
  const phone = document.getElementById("phone").value;

  const { data: existing } = await supabase
    .from("attendance")
    .select("*")
    .eq("phone", phone)
    .is("check_out", null)
    .single();

  if (!existing) {
    await supabase.from("attendance").insert({
      phone: phone,
      check_in: new Date()
    });
    document.getElementById("message").innerText = "Checked In";
  } else {
    await supabase.from("attendance")
      .update({ check_out: new Date() })
      .eq("id", existing.id);
    document.getElementById("message").innerText = "Checked Out";
  }
}
</script>
</body>
</html>
