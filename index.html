<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://kftyyyacxlxaghxwftxd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmdHl5eWFjeGx4YWdoeHdmdHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMTk5MDksImV4cCI6MjA4NzU5NTkwOX0._kaIiALNA2-K0lFf1AJcX-0X2lmxF1c15sUDJAKes3I";
const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

async function submitAttendance() {
  const phone = document.getElementById("phone").value;

  if (!phone) {
    document.getElementById("message").innerText = "Enter phone number";
    return;
  }

  const { data: existing } = await supabaseClient
    .from("attendance")
    .select("*")
    .eq("phone", phone)
    .is("check_out", null)
    .maybeSingle();

  if (!existing) {
    await supabaseClient.from("attendance").insert({
      phone: phone,
      check_in: new Date()
    });
    document.getElementById("message").innerText = "Checked In";
  } else {
    await supabaseClient
      .from("attendance")
      .update({ check_out: new Date() })
      .eq("id", existing.id);
    document.getElementById("message").innerText = "Checked Out";
  }
}
</script>
